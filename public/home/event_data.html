<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0">
        <title>上传活动成果</title>
        <!-- 引入 WeUI -->
        <!-- <link rel="stylesheet" href="path/to/weui/dist/style/weui.min.css"/> -->
        <link rel="stylesheet" href="https://cdn.bootcss.com/weui/1.1.2/style/weui.min.css">
        <link rel="stylesheet" href="https://cdn.bootcss.com/jquery-weui/1.1.2/css/jquery-weui.min.css">
    </head>
    <body style="background-color:#f0eff5">
      <div id="body">
        <div class="weui-cells__tips">执行数据</div>

      </div>
      <div class="weui-btn-area">
        <a class="weui-btn weui-btn_primary" href="javascript:" id="submit">提交</a>
      </div>

      <script src="/js/config.js"></script>
      <script src="https://cdn.bootcss.com/jquery/1.11.0/jquery.min.js"></script>
      <script src="https://cdn.bootcss.com/jquery-weui/1.1.2/js/jquery-weui.min.js"></script>
      <script src="/js/jquery.cookie.js"></script>
      <script src="/js/cookie.js"></script>
      <script>
      $(function(){
        // console.log(token);
        // console.log(username);
         $.ajax({
           url: root_url+"api/users/me",
           method: "GET",
           dataType: "json",
           beforeSend: function(request) {
               request.setRequestHeader("Authorization", "Token token=" + token + ", username=" + username);
           },
           success:function(res){
             if (res.status == 401) window.location.href = 'login';
             else $.ajax({
               url: root_url+"api/events/join_event",
               data: {"event_id": 1},
               method: "post",
               dataType: "json",
               beforeSend: function(request) {
                   request.setRequestHeader("Authorization", "Token token=" + token + ", username=" + username);
               },
               success:function(res){
                 console.log(res.status);

                 var goods=[];
                 $.ajax({
                   url: root_url+"api/events/1",
                   method: "GET",
                   dataType: "json",
                   beforeSend: function(request) {
                       request.setRequestHeader("Authorization", "Token token=" + token + ", username=" + username);
                   },
                   success:function(res){
                     $.each(res.data.event.goods,function(i,t){
                          // goods.push("<option value='"+t.id+"'>"+t.name+"</option>");
                          goods.push("<div class='weui-cells'>");
                          goods.push("<div class='weui-cell'>");
                          goods.push("<div class='weui-cell__hd' ><img style='width: 80px;' src='"+t.image.url+"'></div>");
                          goods.push("<div class='weui-cell__bd'>");
                          goods.push("<p>"+t.brand+t.name+"</p>");
                          goods.push("</div>");
                          goods.push("<div class='weui-cell__ft' style='color:#f1403c'>￥"+t.price+"</div>");
                          goods.push("</div>");
                          goods.push("<div class='weui-cell'>");
                          goods.push("<div class='weui-cell__bd'>");
                          goods.push("<input class='weui-input' type='number' placeholder='进货数量'>");
                          goods.push("</div>");
                          goods.push("<div class='weui-cell__bd'>");
                          goods.push("<input class='weui-input' type='number' placeholder='销售数量'>");
                          goods.push("</div>");
                          goods.push("<div class='weui-cell__bd'>");
                          goods.push("<input class='weui-input' type='number' placeholder='库存数量'>");
                          goods.push("</div>");
                          goods.push("</div>");
                          goods.push("</div>");
                     })
                     $("#body").append(goods.join(''));
                   }
                 });

               }
             });
           }
         });
      });
    </script>
    </body>
</html>
